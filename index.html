<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <title>formularioprueba</title>
</head>
<body>
  <h1>Formulario</h1>
  <br><br>

  <div class="formulario">
    <form id="miForm">

      <input name="nombre_completo" placeholder="Nombre completo" required><br><br>
      <input name="cuit" placeholder="CUIT / CUIL" required><br><br>
      <input name="domicilio" placeholder="Domicilio Fiscal" required><br><br>
      <input name="email" type="email" placeholder="Correo electrónico" required><br><br>
      <input name="asunto" placeholder="Asunto del informe" required><br><br>
      <textarea name="detalle" placeholder="Detalle del reclamo o consulta" rows="4" required></textarea><br><br>
      <input name="anio_fiscal" placeholder="Año fiscal (ej: 2024)" required><br><br>
      <input name="tipo_servicio" placeholder="Tipo de servicio requerido" required><br><br>
      <select name="adjunta_documentacion" required>
        <option value="">¿Adjunta documentación?</option>
        <option value="Sí">Sí</option>
        <option value="No">No</option>
      </select><br><br>
      <textarea name="observaciones" placeholder="Observaciones adicionales" rows="3"></textarea><br><br>
      <input name="matricula" placeholder="Matrícula del profesional" required><br><br>

      <button type="button" onclick="validarFormulario()">Generar Documento</button>

    </form>
  </div>

  <!-- Modal éxito -->
  <div class="modal" id="exampleModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Formulario enviado</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>        
        </div>
      </div>
    </div>
  </div>

  

  <!-- Modal error envío -->
  <div class="modal" id="modalEnvioError" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Error enviando el formulario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>          
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function validarFormulario() {
      const form = document.getElementById("miForm");
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // Armar objeto con los datos del formulario
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // URL completa del webhook de n8n (ajustala a la tuya)
      const webhookUrl = "https://b5c89615a669.ngrok-free.app/webhook/formularito";

      fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      })
        .then((response) => {
          if (!response.ok) throw new Error("Error en la respuesta");
          const modal = new bootstrap.Modal(document.getElementById("exampleModal"));
          modal.show();
          form.reset();
        })
        .catch(() => {
          const modal = new bootstrap.Modal(document.getElementById("modalEnvioError"));
          modal.show();
        });
    }
  </script>

</body>
</html>
